#!/bin/bash

set -e

function update_one {
  local url=$1
  local name=${url##*/}

  if [ -e "$name" ]; then
    (
    cd $name
    if [ -z "$(git status --porcelain)" ]; then
      echo updating $name
      git -c color.ui=always pull
    else
      echo fetching $name
      git -c color.ui=always fetch
    fi
    )
  else
    git clone $url $name
  fi
}
export -f update_one

function main {
  parallel update_one < repos.txt
}

main
